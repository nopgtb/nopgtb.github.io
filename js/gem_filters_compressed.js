function set_filter_url(e){var a,n=e.className,c=e.value,o=e.checked;let t=window.location.search.substring(1);if(t){let l=t.split("&"),i=!1;for(let t=0;t<l.length;++t){let e=l[t].split("=");e&&e[0]==n&&(i=!0,values=e[1].split(","),values&&(o&&!values.includes(c)?values.push(c):!o&&values.includes(c)&&(a=values.indexOf(c),values.splice(a,1)),e[1]=values.join(","),0<e[1].length?l[t]=e.join("="):l.splice(t,1)))}i||l.push(n+"="+c);var s=l.join("&");t=s?"?"+s:""}else t="?"+n+"="+c;s=location.origin+location.pathname+t;window.history.pushState({},"",new URL(s))}function get_active_color_filters(){let t=[];return document.querySelectorAll("#gem-color > div > input").forEach(e=>{e.checked&&t.push(Number(e.value))}),t}function get_active_size_filters(){let t=[];return document.querySelectorAll("#gem-size > div > input").forEach(e=>{e.checked&&t.push(Number(e.value))}),t}function get_active_stat_filters(){let t=[];return document.querySelectorAll("#gem-stat > div > input").forEach(e=>{e.checked&&t.push(Number(e.value))}),t}function get_stat_element(l,i){let a=null;i=i.find(e=>e.eid==l.eid);if(i){a=document.createElement("span"),a.className="gem-stat";let e="+";l.amount<0&&(e="-");let t=e+Math.abs(l.amount);l.percentage&&(t+="%"),t+=" "+i.name,a.innerText=t}return a}function create_gem_display(e){let t=document.createElement("div"),l=e.socket_color;var i="gem-listing gem-bg-"+l.sort().join("");t.className=i;let a=document.createElement("div");a.className="gem-info text";let n=document.createElement("a");n.className="gem-name",n.href="https://www.wowhead.com/wotlk/item="+e.wowhead_item_id,n.innerText=e.name,n.setAttribute("data-wh-rename-link","false"),n.setAttribute("data-wh-iconize-link","false"),n.setAttribute("data-wh-color-link","false"),n.target="_blank",a.appendChild(n);let c=document.createElement("div");var o;e.gem_stats.forEach(e=>{(o=get_stat_element(e,stats_table_))&&c.appendChild(o)}),a.appendChild(c);let s=document.createElement("div");s.className="gem-icon";let r=document.createElement("a");return r.href="https://www.wowhead.com/wotlk/item="+e.wowhead_item_id,r.className="q3",r.setAttribute("data-wowhead","item="+e.wowhead_item_id),r.setAttribute("data-wh-icon-size","medium"),s.appendChild(r),t.appendChild(a),t.appendChild(s),t}function display_gems(e){let t=document.getElementById("gem-display");t.textContent="",e.forEach(e=>{e=create_gem_display(e);t.appendChild(e)}),WH.Tooltips.refreshLinks()}function apply_filters(){let e=get_active_color_filters(),t=get_active_size_filters(),l=get_active_stat_filters(),i=gem_table_;return 0<e.length&&(i=i.filter(t=>e.every(e=>t.socket_color.includes(e)))),0<t.length&&(i=i.filter(e=>t.includes(e.gem_size))),0<l.length&&(i=i.filter(e=>l.every(t=>e.gem_stats.some(e=>e.eid==t)))),i}function filter_value_change(e){set_filter_url(e.target),display_gems(apply_filters())}function create_checkbox(i,a){if(i.use_for_sorting){let e=document.createElement("div");e.className="checkbox-container";var n=(a+"-"+i.eid).toLowerCase();let t=document.createElement("input");t.type="checkbox",t.className=a,t.name=n,t.value=i.eid,t.addEventListener("change",e=>{console.log(e),filter_value_change(e)});let l=document.createElement("label");return l.innerText=i.name,l.htmlFor=n,e.appendChild(t),e.appendChild(l),e}return null}function init_color_checkboxes(){color_table_.forEach(e=>{e=create_checkbox(e,"gem-color");e&&document.getElementById("gem-color").appendChild(e)})}function init_size_checkboxes(){size_table_.forEach(e=>{e=create_checkbox(e,"gem-size");e&&document.getElementById("gem-size").appendChild(e)})}function init_stat_checkboxes(){stats_table_.forEach(e=>{e=create_checkbox(e,"gem-stat");e&&document.getElementById("gem-stat").appendChild(e)})}function init_gem_filter(){let t=window.location.search.substring(1);if(t){let e=t.split("&");e.forEach(e=>{let l=e.split("=");l&&(values=l[1].split(","),values&&values.forEach(e=>{e="#"+l[0]+" > div > input[name='"+l[0]+"-"+e+"']";let t=document.querySelector(e);t&&(t.checked=!0)}))})}}function initialize(){init_color_checkboxes(),init_size_checkboxes(),init_stat_checkboxes(),init_gem_filter(),display_gems(apply_filters())}window.onload=initialize;